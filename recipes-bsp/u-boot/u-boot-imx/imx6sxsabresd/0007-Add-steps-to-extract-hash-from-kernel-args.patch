From 20e201c6f23cc7952c069adeb46f5a900e0c58a8 Mon Sep 17 00:00:00 2001
From: sathishkumar-rk <sathishkumar.k@jasmin-infotech.com>
Date: Mon, 9 Oct 2023 16:00:25 +0530
Subject: [PATCH] Add steps to extract hash from kernel args

---
 include/configs/mx6sxsabresd.h | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/include/configs/mx6sxsabresd.h b/include/configs/mx6sxsabresd.h
index 60c04159b6..430f11137d 100644
--- a/include/configs/mx6sxsabresd.h
+++ b/include/configs/mx6sxsabresd.h
@@ -83,10 +83,12 @@
 	"fdt_file=undefined\0" \
 	"fdt_addr=0x83000000\0" \
 	"tee_addr=0x84000000\0" \
+	"hash_addr=0x88800000\0" \
 	"tee_file=uTee-6sxsdb\0" \
 	"live_initramfs_file=core-image-minimal-live-initramfs-imx6sxsabresd.cpio.gz\0" \
 	"mfg_initramfs_file=core-image-minimal-mfg-initramfs-imx6sxsabresd.cpio.gz\0" \
 	"prod_initramfs_file=core-image-minimal-prod-initramfs-imx6sxsabresd.cpio.gz\0" \
+	"public_key_hash_file=public_key_hash_file.bin\0" \
 	"boot_fdt=try\0" \
 	"ip_dyn=yes\0" \
 	"splashimage=0x8c000000\0" \
@@ -95,7 +97,7 @@
 	"mmcroot=" CONFIG_MMCROOT " rootwait rw\0" \
 	"mmcautodetect=yes\0" \
 	"mmcargs=setenv bootargs console=${console},${baudrate} " \
-		"root=${mmcroot}\0" \
+		"root=${mmcroot} hash=${hash}\0" \
 	"loadbootscript=" \
 		"fatload mmc ${mmcdev}:${mmcpart} ${loadaddr} ${script};\0" \
 	"bootscript=echo Running bootscript from mmc ...; " \
@@ -106,6 +108,7 @@
 	"loadliveinitramfs=fatload mmc ${mmcdev}:${mmcpart} ${initrd_addr} ${live_initramfs_file}\0" \
 	"loadmfginitramfs=fatload mmc ${mmcdev}:${mmcpart} ${initrd_addr} ${mfg_initramfs_file}\0" \
 	"loadprodinitramfs=fatload mmc ${mmcdev}:${mmcpart} ${initrd_addr} ${prod_initramfs_file}\0" \
+	"loadpublickeyhash=fatload mmc ${mmcdev}:${mmcpart} ${hash_addr} ${public_key_hash_file}\0" \
 	"liveinitramfskernelboot=echo Booting live initramfs  . . .;" \
                            "setenv fdt_file imx6sx-sdb.dtb; " \
 			    "run mmcargs; " \
@@ -122,6 +125,8 @@
                             "bootz ${loadaddr} ${initrd_addr}:${filesize} ${fdt_addr};\0" \
 	"prodinitramfskernelboot=echo Booting production initramfs  . . .;" \
                             "setenv fdt_file imx6sx-sdb.dtb; " \
+			    "run loadpublickeyhash;" \
+			    "setvar hash ${hash_addr} 20;" \
                             "run mmcargs; " \
                             "run loadimage; " \
                             "run loadfdt; " \
